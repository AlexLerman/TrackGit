#!/usr/bin/env ruby

require 'pathname'
require "Trollop"

# lib = (Pathname.new(__FILE__).realpath.dirname  + '../lib').to_s
# $LOAD_PATH.unshift(lib) if File.directory?(lib) && !$LOAD_PATH.include?(lib)

require_relative '../lib/TrackGit'

track = TrackGit.new

all_arguments = ""
ARGV.each do |arg|
  if arg.include? " "
    all_arguments += " \"#{arg}\" "
  else
    all_arguments += " #{arg}"
  end
end

SUB_COMMANDS = %w(checkout createIssue delete commit getComments addComment login setTracker setRepo merge test up down)
global_opts = Trollop::options do
  banner "magic file deleting and copying utility"
  opt :dry_run, "Don't actually do anything", :short => "-n"
  stop_on SUB_COMMANDS
end

cmd = ARGV.shift # get the subcommand
cmd_opts = case cmd
when "checkout" # parse delete options
    Trollop::options do
      opt :test, "test"
    end
    track.checkoutIssue(ARGV[0])
  when "createIssue"  # parse copy options
    Trollop::options do
      opt :test, "test"
    end
    track.createIssue(ARGV)
  when "delete"  # parse copy options
    track.deleteBranch(ARGV[0])
  when "commit"  # parse copy options
    track.commit(ARGV[0])
  when "getComments"
    track.getComments
  when "addComment"
    track.addComment(ARGV[0])
  when "login"
    track.login(ARGV)
  when "setTracker"
    track.setTracker(ARGV[0])
  when "setRepo"
    track.setRepo(ARGV[0])
  when "merge"
    track.merge(ARGV[0])
  when "up"
    track.up
  when "down"
    track.down
  when "test"
    opts = Trollop::options do
      opt :test, "test", :type => :string
      opt :die, "Do or die", :short => "-d"
    end
  else
    puts "executing as git"
    puts `git#{all_arguments}`
    # Trollop::die "unknown subcommand #{cmd.inspect}"
  end
